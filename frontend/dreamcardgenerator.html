<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Card Generator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
    margin: 0;
    padding: 0;
    background-color: #f8f9fa;
  }

  .navbar {
    background-color: #0d254f !important;
    padding: 15px0;
  }

  .navbar .nav-link {
    color: white !important;
}

.navbar .nav-link.active {
    text-decoration: underline;
    text-underline-offset: 5px;
}

.paper {
    position: relative;
    background: white;
    width: 100%;
    height: 200px;
    margin-top: -5px;
}

.paper::after {
    content: "";
    position: absolute;
    bottom: -40px;
    left: 0;
    width: 100%;
    height: 40px;
    background: white;
    clip-path: polygon(50% 100%, 0% 0%, 100% 0%);
    z-index: 10;
}
 
.navbar .nav-link {
color: white;
text-decoration: none !important;
}

select.form-select option {
    background-color: navy;
    color: white;
}

select.form-select:fokus {
    box-shadow: 0 0 5px navy;
    border-color: navy;
}

.alert {
    display: none;
    margin-top: 15px;
}
</style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light p-3" style="width: 100%;">
        <div class="container width: 100%;">
          <a class="navbar-brand d-flex align-item-center" href="#">
            <img src="logo_transparent[1].png" alt="Logo" width="50" height="50" class="me-2">
            <a class="nav-link text-white fw-bold" href="#">My Dream Cards</a>
          </a>
    
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
          </button>
    
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mx-auto">
              <li class="nav-item">
                <a class="nav-link"  href="landing page.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="dreamcardgenerator.html">Dream Card Generator</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="templates.html">Templates</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">About Us</a>
              </li>
            </ul>
    
            <ul class="navbar-nav ms-auto" id="auth-section">
              <li class="nav-item">
                <a class="nav-link" href="login.html">Log In</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    <div class="container mt-5">
      <p class="text-center fs-5 fw-bold"><span>Dream Card Generator</span></p>
      <p class="text-center fs-6 fw-bold"><span>Buat wishlist impianmu dengan mudah!</span></p>
    </div>
    
    <!-- Alert for messages -->
    <div class="container">
        <div id="alertBox" class="alert" role="alert"></div>
    </div>
    
    <section class="container">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <p class="text-center fs-6">Buat dan cetak Dream Card-mu sendiri dengan aplikasi gratis dan sederhana ini. Generator kami akan mengacak item wishlist-mu untuk menciptakan kartu Dream Card yang unik dan menarik.</p>
          <div class="row justify-content-center">
            <div class="col-md-6">
                
                <form id="dreamCardForm">
                    <div class="mb-3">
                        <label class="fw-bold">Masukkan Judul</label>
                        <input type="text" id="cardTitle" class="form-control" placeholder="Buat Dream Card-mu Sendiri!">
                    </div>
    
                    <div class="mb-3">
                        <label class="fw-bold">Masukkan item wishlist atau angka</label>
                        <textarea id="wishlistItems" class="form-control" rows="4" placeholder="Tambahkan item di sini..."></textarea>
                    </div>
    
                    <div class="mb-3">
                        <label class="fw-bold">Pilihan Tema</label>
                        <select id="themeSelect" class="form-select">
                            <option selected>Pilih Tema</option>
                            <option value="1">Tema 1</option>
                            <option value="2">Tema 2</option>
                        </select>
                    </div>
    
                    <div class="mb-3">
                        <label class="fw-bold">Ukuran Kotak</label>
                        <select id="sizeSelect" class="form-select">
                            <option selected value="auto">Otomatis</option>
                            <option value="3">3x3</option>
                            <option value="4">4x4</option>
                            <option value="5">5x5</option>
                        </select>
                    </div>
                </form>
            </div>
            <br>
            <div class="col-md-4 text-center">
                <img src="Screenshot 2025-02-14 223202.png" class="img-thumbnail" alt="Template Dream Card" width="250">
                <button id="nextButton" class="btn btn-danger mt-3 w-100">Tahap Selanjutnya</button>
            </div>
            <footer class="bg-dark text-white py-4 mt-5">
                <div class="container mt-4">
                    <div class="row text-center text-md-start">
                        
                        <div class="col-md-4 mb-3">
                            <h5 class="fw-bold">My Dream Cards</h5>
                            <p>Buat wishlist impianmu dengan Dream Card Generator kami yang mudah digunakan!
              
                              di rumah atau bagikan secara virtual kepada teman dan keluarga.</p>
                        </div>
              
                        <div class="col-md-4 mb-3">
                            <h5 class="fw-bold">Links</h5>
                            <ul class="list-unstyled">
                                <li><a href="#" class="text-white text-decoration-none">Home</a></li>
                                <li><a href="#" class="text-white text-decoration-none">Dream Card Generator</a></li> 
                                <li><a href="#" class="text-white text-decoration-none">Templates</a></li> 
                                <li><a href="#" class="text-white text-decoration-none">About</a></li> 
                            </ul>
                        </div> 
                      
                        <div class="col-md-4 mb-3">
                            <h5 class="fw-bold">Ikuti Kami</h5>
                            <a href="#" class="text-white text-decoration-none d-block"><i class="bi bi-facebook me-2"></i><strong>Facebook :</strong> DreamCards_offical</a>
                            <a href="#" class="text-white text-decoration-none d-block"><i class="bi bi-instagram me-2"></i><strong>Instagram :</strong> DreamCards_offical</a>
                            <a href="#" class="text-white text-decoration-none d-block"><i class="bi bi-twitter me-2"></i><strong>Twitter :</strong> DreamCard_offical</a>
                        </div>
                    </div>
              
                    <hr class="border-secondary">
            
                    <div class="text-center pb-3">
                        <p class="mb-0">&copy; 2025 mydreamcards.com | All rights reserved.</p>
                    </div>
                </div>
              </footer>
              
              <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
                
                  
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Check if token exists when page loads
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            if (token) {
                // User is logged in, fetch profile and update UI
                fetchProfile();
            }
        });

        // Show alert messages
        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.textContent = message;
            alertBox.className = `alert alert-${type}`;
            alertBox.style.display = 'block';
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 5000);
        }

        // Fetch user profile
        async function fetchProfile() {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch('http://localhost:3001/api/user/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    updateAuthSection(data.name);
                } else {
                    // If profile fetch fails, token might be invalid
                    localStorage.removeItem('token');
                }
            } catch (err) {
                showAlert('Failed to fetch profile', 'danger');
            }
        }

        // Update the auth section in the navbar
        function updateAuthSection(username) {
            const authSection = document.getElementById('auth-section');
            authSection.innerHTML = `
                <li class="nav-item">
                    <span class="nav-link text-white">${username}</span>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="logout(); return false;">Logout</a>
                </li>
            `;
        }

        // Handle logout
        function logout() {
            localStorage.removeItem('token');
            window.location.href = 'login.html';
        }

        // Handle form submission
        document.getElementById('nextButton').addEventListener('click', async function() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            // Get form values
            const title = document.getElementById('cardTitle').value;
            const wishlistText = document.getElementById('wishlistItems').value;
            const size = document.getElementById('sizeSelect').value;
            
            // Basic validation
            if (!title.trim()) {
                showAlert('Mohon masukkan judul', 'warning');
                return;
            }
            
            if (!wishlistText.trim()) {
                showAlert('Mohon masukkan item wishlist', 'warning');
                return;
            }
            
            // Parse wishlist items into individual cells
            const wishlistItems = wishlistText.split('\n').filter(item => item.trim() !== '');
            
            // Calculate grid size
            let gridSize;
            if (size === 'auto') {
                // Calculate the nearest square that can fit all items
                gridSize = Math.ceil(Math.sqrt(wishlistItems.length));
            } else {
                gridSize = parseInt(size);
            }
            
            // Create cells object
            const cells = {};
            wishlistItems.forEach((item, index) => {
                if (index < gridSize * gridSize) {
                    cells[index + 1] = {
                        title: item.trim(),
                        done: "no"
                    };
                }
            });
            
            // Prepare the payload
            const payload = {
                target: {
                    header: {
                        size: {
                            height: gridSize,
                            width: gridSize
                        },
                        totalcells: gridSize * gridSize,
                        maximum_time: "2025-12-31T23:59:59Z"
                    },
                    cells: cells
                },
                bound_to: 19,  // You might want to make this dynamic
                permit_user: 3,  // You might want to make this dynamic
                permit_visible: 0  // You might want to make this dynamic
            };
            
            try {
                // Send the request
                const response = await fetch('http://localhost:3001/api/target/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(payload)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showAlert('Dream Card berhasil dibuat!', 'success');
                    
                    // You might want to redirect to another page or show the created card
                    console.log('Success:', data);
                } else {
                    // Handle error responses
                    const error = await response.json();
                    showAlert(error.message || 'Gagal membuat Dream Card', 'danger');
                }
            } catch (err) {
                showAlert('Gagal terhubung ke server', 'danger');
                console.error('Error:', err);
            }
        });
    </script>
</body>
</html>